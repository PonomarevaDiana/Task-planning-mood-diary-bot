from aiogram import Router, F
from aiogram.types import Message
from aiogram.filters import Command
from pathlib import Path
import sys
from aiogram.fsm.context import FSMContext

current_dir = Path(__file__).parent
project_root = current_dir.parent
sys.path.insert(0, str(project_root))

from database import db
from keyboards import (
    get_main_keyboard,
    get_help_keyboard,
    get_tasks_keyboard,
    get_moods_keyboard,
    get_analytics_keyboard,
    get_notifications_keyboard,
    get_tags_keyboard,
    get_period_keyboard,
    get_grouping_keyboard,
)

router = Router()


@router.message(Command("start"))
@router.message(F.text == "üöÄ –°—Ç–∞—Ä—Ç")
@router.message(F.text == "üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É")
async def cmd_start(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã start –∏ –∫–Ω–æ–ø–æ–∫ —Å—Ç–∞—Ä—Ç–∞"""
    await state.clear()

    await db.add_user(
        message.from_user.id, message.from_user.username, message.from_user.first_name
    )

    user_name = message.from_user.first_name
    username = f" @{message.from_user.username}" if message.from_user.username else ""

    welcome_text = f"""
üëã –ü—Ä–∏–≤–µ—Ç, {user_name}{username}!

–Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.

üéØ <b>–ß—Ç–æ —è —É–º–µ—é:</b>

üìù <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏:</b>
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: üî¥ –≤—ã—Å–æ–∫–∏–π, üü° —Å—Ä–µ–¥–Ω–∏–π, üü¢ –Ω–∏–∑–∫–∏–π
‚Ä¢ –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
‚Ä¢ –†–∞–±–æ—Ç–∞ —Å —Ç–µ–≥–∞–º–∏

üòä <b>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è:</b>
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
‚Ä¢ –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
‚Ä¢ –ó–∞–º–µ—Ç–∫–∏ –∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º

üìä <b>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –∏ —Ç–µ–≥–∞–º
‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
‚Ä¢ –°–≤–æ–¥–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

üîî <b>–£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</b>
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–∫–∞—Ö
‚Ä¢ –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏

–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é –Ω–∏–∂–µ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É! üöÄ
"""

    await message.answer(
        welcome_text, reply_markup=get_main_keyboard(), parse_mode="HTML"
    )


MENU_MAPPING = {
    "üîô –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º": (get_tasks_keyboard, "üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏"),
    "üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º": (get_moods_keyboard, "üòä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º–∏"),
    "üîô –ù–∞–∑–∞–¥ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ": (get_analytics_keyboard, "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞"),
    "üîô –ù–∞–∑–∞–¥ –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º": (get_notifications_keyboard, "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),
    "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é": (get_main_keyboard, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"),
    "üîô –ù–∞–∑–∞–¥ –∫ –ø–µ—Ä–∏–æ–¥–∞–º": (get_period_keyboard, "üìÖ –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"),
    "üîô –ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ": (get_grouping_keyboard, "üìä –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á"),
    "üîô –ù–∞–∑–∞–¥ –∫ —Ç–µ–≥–∞–º": (get_tags_keyboard, "üè∑Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏"),
}

NAVIGATION_BUTTONS = {
    "‚ùå –û—Ç–º–µ–Ω–∞",
    "üîô –ù–∞–∑–∞–¥",
    "üîô –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º",
    "üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º",
    "üîô –ù–∞–∑–∞–¥ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ",
    "üîô –ù–∞–∑–∞–¥ –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º",
    "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
    "üîô –ù–∞–∑–∞–¥ –∫ –ø–µ—Ä–∏–æ–¥–∞–º",
    "üîô –ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ",
    "üîô –ù–∞–∑–∞–¥ –∫ —Ç–µ–≥–∞–º",
}


def get_section_from_state(current_state: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é FSM"""
    if not current_state:
        return "main"

    state_str = str(current_state)

    if any(keyword in state_str for keyword in ["Task", "task"]):
        return "tasks"

    elif any(keyword in state_str for keyword in ["Mood", "mood"]):
        return "moods"

    elif any(keyword in state_str for keyword in ["Analytics", "analytics"]):
        return "analytics"

    elif any(keyword in state_str for keyword in ["Reminder", "reminder"]):
        return "notifications"
    elif any(keyword in state_str for keyword in ["Tag", "tag"]):
        return "tags"
    else:
        return "main"


SECTION_KEYBOARDS = {
    "tasks": (get_tasks_keyboard, "üìã –í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é –∑–∞–¥–∞—á"),
    "tags": (get_tags_keyboard, "üè∑Ô∏è –í–æ–∑–≤—Ä–∞—Ç –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ç–µ–≥–∞–º–∏"),
    "moods": (get_moods_keyboard, "üòä –í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π"),
    "notifications": (get_notifications_keyboard, "üîî –í–æ–∑–≤—Ä–∞—Ç –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º"),
    "analytics": (get_analytics_keyboard, "üìä –í–æ–∑–≤—Ä–∞—Ç –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ"),
    "main": (get_main_keyboard, "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"),
}


async def handle_navigation(message: Message, state: FSMContext) -> bool:
    """–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏"""
    current_state = await state.get_state()
    user_text = message.text.strip()

    if user_text in NAVIGATION_BUTTONS:

        if user_text in MENU_MAPPING:
            keyboard_func, message_text = MENU_MAPPING[user_text]
            await state.clear()
            await message.answer(message_text, reply_markup=keyboard_func())
            return True

    if user_text in ["‚ùå –û—Ç–º–µ–Ω–∞", "üîô –ù–∞–∑–∞–¥"]:

        current_section = get_section_from_state(current_state)

        if current_section in SECTION_KEYBOARDS:
            keyboard_func, message_text = SECTION_KEYBOARDS[current_section]

            if user_text == "‚ùå –û—Ç–º–µ–Ω–∞":
                response_text = "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
            else:  # "üîô –ù–∞–∑–∞–¥"
                response_text = message_text

            await state.clear()
            await message.answer(response_text, reply_markup=keyboard_func())
        else:
            await state.clear()
            await message.answer("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", reply_markup=get_main_keyboard())

        return True

    return False


@router.message(F.text == "‚ùì –ü–æ–º–æ—â—å")
@router.message(Command("help"))
async def cmd_help(message: Message):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø–æ–º–æ—â–∏"""
    help_text = (
        "üé™ <b>–¶–ï–ù–¢–† –ü–û–ú–û–©–ò –ò –ü–û–î–î–ï–†–ñ–ö–ò</b>\n\n"
        "‚ú® <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!</b> ‚ú®\n\n"
        "üöÄ <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª, —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã:</i>\n\n"
        "üìã <b>–†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏</b>\n"
        "üè∑Ô∏è <b>–†–∞–±–æ—Ç–∞ —Å —Ç–µ–≥–∞–º–∏</b>\n"
        "üìä <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</b>\n"
        "üîî <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</b>\n"
        "üòä <b>–†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º–∏</b>\n"
        "üßπ <b>–ß–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</b>\n\n"
        "üéØ <b>–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!</b>"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏")
async def help_tasks(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∑–∞–¥–∞—á–∞–º–∏"""
    help_text = (
        "<b>üöÄ –ú–ê–°–¢–ï–†–°–¢–í–û –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–î–ê–ß–ê–ú–ò</b>\n\n"
        "<b>–°–û–ó–î–ê–ù–ò–ï –ò –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï:</b>\n"
        "\n"
        "üìù <b>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</b>\n"
        "‚è∞ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ä–æ–∫–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã\n"
        "üéØ –í—ã–±–∏—Ä–∞–π—Ç–µ –∏–∑ 3 —É—Ä–æ–≤–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏ (–≤—ã—Å–æ–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –Ω–∏–∑–∫–∏–π)\n"
        "‚úÖ <b>–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É</b>\n"
        "‚úèÔ∏è <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</b>\n"
        "üóëÔ∏è <b>–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É</b>\n"
        "üîÑ <b>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É</b>\n"
        "\n"
        "<b>–ú–û–©–ù–´–ô –ü–†–û–°–ú–û–¢–†, –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –∏ –ì–†–£–ü–ü–ò–†–û–í–ö–ê:</b>\n\n"
        "\n"
        "üìã <b>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</b> - –≤—Å–µ –≤–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∏—Å—Å–∏–∏\n"
        "üö® <b>–°—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏</b> - –≥–æ—Ä—è—â–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã!\n"
        "‚è∞ <b>–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏</b> - –±—É–¥—É—â–∏–µ –ø–æ–±–µ–¥—ã\n"
        "‚ö†Ô∏è <b>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</b> - –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ\n"
        "üìÖ <b>–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</b> - —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç\n"
        "üéØ <b>–§–∏–ª—å—Ç—Ä—ã –∑–∞–¥–∞—á</b> - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏\n"
        "üìã <b>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á</b> - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—å—é –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏\n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –†–∞–±–æ—Ç–∞ —Ç–µ–≥–∞–º–∏")
async def help_tags(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç–µ–≥–∞–º–∏"""
    help_text = (
        "üìù <b>–í–û–õ–®–ï–ë–°–¢–í–û –¢–ï–ì–û–í</b>\n\n"
        "<b>–û–°–ù–û–í–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:</b>\n"
        "\n"
        "üè∑Ô∏è <b>–°–æ–∑–¥–∞—Ç—å —Ç–µ–≥</b> \n"
        "üìã <b>–°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤</b>\n"
        "‚ûï <b>–î–æ–±–∞–≤–∏—Ç—å –∫ –∑–∞–¥–∞—á–µ</b>!\n"
        "\n"
        "<b>–°–ò–õ–ê –¢–ï–ì–û–í :</b>\n"
        "\n"
        "üéØ <b>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞</b> - –æ–±—ä–µ–¥–∏–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º\n"
        "üîç <b>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</b> - –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\n"
        "‚ö° <b>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</b> - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º\n"
        "\n"
        "üí° <b>–ì–æ—Ç–æ–≤—ã–µ —Ç–µ–≥–∏:</b>\n"
        "\n"
        "üíº #—Ä–∞–±–æ—Ç–∞   ‚ù§Ô∏è #–ª–∏—á–Ω–æ–µ\n"
        "üéì #–æ–±—É—á–µ–Ω–∏–µ üè† #–¥–æ–º\n"
        "üí™ #–∑–¥–æ—Ä–æ–≤—å–µ üí∞ #—Ñ–∏–Ω–∞–Ω—Å—ã\n"
        "üöÄ #–ø—Ä–æ–µ–∫—Ç–•  ‚ö° #—Å—Ä–æ—á–Ω–æ\n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏")
async def help_analytics(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
    help_text = (
        "üìä <b>–ú–ê–ì–ò–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò</b> \n\n"
        "<b>–ê–ù–ê–õ–ò–¢–ò–ö–ê –ó–ê–î–ê–ß:</b>\n"
        "\n"
        "üìã <b>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Å–≤–æ–¥–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</b> - –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n"
        "üìà <b>–î–∏–Ω–∞–º–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b> - —É–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º\n"
        "üöÄ <b>–†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∏–¥—ã –∞–Ω–∞–ª–∏–∑–∞</b> - —Ç–µ–≥–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã\n"
        "üéØ <b>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</b> - –≥–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n"
        "\n\n"
        "<b>–≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê:</b>\n"
        "\n"
        "üòä <b>–ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</b> \n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")
async def help_notifications(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    help_text = (
        "üîî <b>–ù–ê–°–¢–†–û–ô–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô</b> \n\n"
        "<b>–ì–õ–ê–í–ù–´–ô –¶–ï–ù–¢–† –£–ü–†–ê–í–õ–ï–ù–ò–Ø:</b>\n"
        "\n"
        "‚ö° <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</b> - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n"
        "‚è∞ <b>–í—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</b> - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è\n"
        "üì± <b>–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</b> - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏, –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π\n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º–∏")
async def help_moods(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º–∏"""
    help_text = (
        "üòä <b>–≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ò–ù–¢–ï–õ–õ–ï–ö–¢ –í –î–ï–ô–°–¢–í–ò–ò</b> \n\n"
        "<b>–û–°–ù–û–í–ù–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:</b>\n"
        "\n"
        "üòä <b>–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</b> - –±—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å\n"
        "üìä <b>–°–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</b> - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å\n"
        "üìù <b>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</b> - –ø–æ—è—Å–Ω–µ–Ω–∏–µ\n"
        "üìÖ <b>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</b> - —É–¥–æ–±–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n"
        "\n"
        "<b>–ü–ê–õ–ò–¢–†–ê –≠–ú–û–¶–ò–ô:</b>\n"
        "\n"
        "üòä –æ—Ç–ª–∏—á–Ω–æ\n"
        "üôÇ —Ö–æ—Ä–æ—à–æ\n"
        "üòê –Ω–æ—Ä–º–∞–ª—å–Ω–æ\n"
        "üòî –ø–ª–æ—Ö–æ \n"
        "üò¢ —É–∂–∞—Å–Ω–æ\n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message(F.text == "‚ùì –ß–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞")
async def help_cleanup(message: Message):
    """–ü–æ–º–æ—â—å –ø–æ —á–∏—Å—Ç–∫–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"""
    help_text = (
        "üßπ <b>–ì–ï–ù–ï–†–ê–õ–¨–ù–ê–Ø –£–ë–û–†–ö–ê –í–ê–®–ï–ì–û –ü–†–û–°–¢–†–ê–ù–°–¢–í–ê –î–ê–ù–ù–´–•</b>\n\n"
        "\n"
        "‚úÖ <b>–û—á–∏—Å—Ç–∫–∞</b> - —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∑–∞–¥–∞—á\n"
        "üóëÔ∏è <b>–û—á–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</b> - –¥–æ—Å—Ç—É–ø –∫ –æ—á–∏—Å—Ç–∫–µ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é\n"
        "üìà <b>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞</b> - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00\n"
        "\n"
    )
    await message.answer(help_text, parse_mode="HTML", reply_markup=get_help_keyboard())


@router.message()
async def universal_handler(message: Message, state: FSMContext):
    """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    navigation_handled = await handle_navigation(message, state)
    if navigation_handled:
        return

    await message.answer(
        "ü§î –Ø –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.",
        reply_markup=get_main_keyboard(),
    )
